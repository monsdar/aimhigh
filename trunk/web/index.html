<html>
    <head>
        <title>AimHigh-Test</title>
        <link type='text/css' rel='stylesheet' href='stylesheet.css'>
        <!-- This includes jQuery 1.9.0 from Google -->
        <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
        <!-- Include other required scripts -->
        <script type="text/javascript" src="extends.js"></script>
    </head>
    <body>
        <div class='category'>
        </div>
        <script type="text/javascript">
            $(document).ready(function()
            {
                //get the userKey
                var userKey = $.getUserKey();
                                
                //if the userkey is empty, we need to create a new user here
                if(userKey == '')
                {
                    //TODO: Create a new user here
                    userKey = 'TestUser';
                }
                
                //let's query the aimhigh-interface for content
                var aimHigh="http://aimhigh.nilsbrinkmann.com/interface.php";
                var postVars = {userkey: userKey, request: 'getTasks'};
                $.post(aimHigh, postVars, function(data) {
                    var json = $.parseJSON(data);
                    $.each(json, function(i, item)
                    {
                        $('.category').append('<div class="task" id="#id' + item.index + '"><p>' + item.text + '</p></div>');
                    });
                });
                
                $(document).on('mouseenter', '.task', function() {
                    //animate to the new size
                    var newHeight = $(this).css('height','auto').height();
                    $(this).animate({ height: 73 }, 'fast', 'swing', function() {
                        $(this).css('height', 'auto');
                    });
                    
                    $(this).css('background-color', '#8BC48B');
                    $(this).append('<span class="editLink">Edit</span>');
                    $(this).append('<span class="deleteLink">Delete</span>');
                    
                });
                $(document).on('mouseleave', '.task', function() {
                    //animate to the new size
                    var newHeight = $(this).css('height','auto').height();
                    $(this).animate({ height: 54 }, 'fast', 'swing', function() {
                        $(this).css('height', 'auto');
                    });
                    
                    $(this).css('background-color', '#dedede');
                    $('.editLink').remove();
                    $('.deleteLink').remove();
                });
                $(document).on('click', '.task', function() {
                    $(this).toggleClass('solvedTask');
                });
                
                $(document).on('mouseenter', '.editLink', function() {
                    $(this).toggleClass('linkHighlighted');
                });
                $(document).on('mouseleave', '.editLink', function() {
                    $(this).toggleClass('linkHighlighted');
                });
                $(document).on('click', '.editLink', function() {
                    var text = $(this).closest('.task').find('p');
                    var newContent = '<div class="editForm">';
                    newContent = newContent + '<input type="text" value="' + text.text() + '" />';
                    newContent = newContent + '<button type="button" class="submitButton">Submit</button>';
                    newContent = newContent + '</div>';
                    text.replaceWith(newContent);
                });
                
                $(document).on('mouseenter', '.deleteLink', function() {
                    $(this).toggleClass('linkHighlighted');
                });
                $(document).on('mouseleave', '.deleteLink', function() {
                    $(this).toggleClass('linkHighlighted');
                });
                $(document).on('click', '.deleteLink', function() {
                    $(this).closest('.task').fadeTo('slow', 0, function() {
                        $(this).closest('.task').slideUp();
                    });
                });
                
                $(document).on('click', '.submitButton', function() {
                    var editForm = $(this).closest('.editForm');
                    var input = editForm.find('input');
                    var newContent = '<p>' + input.val() + '</p>';
                    editForm.replaceWith(newContent);
                });
            });
                
	</script>
    </body>
</html>
